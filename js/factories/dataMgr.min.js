var months=["","January","February","March","April","May","June","July","August","September","October","November","December"],localCache={};ngapp.factory("dataMgr",["$http","$route","$rootScope",function(n,t,i){var g=!1,a="https://s3-eu-west-1.amazonaws.com/msil-international-directory/reos.json",u="mstphDirREOs3",nt="https://s3-eu-west-1.amazonaws.com/msil-international-directory/committees.json",tt="mstphDirComms3",v="https://s3-eu-west-1.amazonaws.com/msil-international-directory/countries.json",f="mstphDirCountries3",y="https://s3-eu-west-1.amazonaws.com/msil-international-directory/menuItems.json",e="mstphDirMenuItems3",p="https://s3-eu-west-1.amazonaws.com/msil-international-directory/pageContents.json",o="mstphDirPageContents3",w="https://s3-eu-west-1.amazonaws.com/msil-international-directory/firms.json",s="mstphDirFirms3",b="https://s3-eu-west-1.amazonaws.com/msil-international-directory/correspondentFirms.json",h="mstphDirCorrespondentFirms3",k="https://s3-eu-west-1.amazonaws.com/msil-international-directory/AssociatedFirms.json",c="mstphDirAssociatedFirms3",d="https://s3-eu-west-1.amazonaws.com/msil-international-directory/contacts.json",l="mstphDirContacts3",it="https://cdn.moorestephens.org/InternationalDirectory/api/contacts/GetSimilarPhrases?txt=",rt="https://cdn.moorestephens.org/InternationalDirectory/api/firms/GetSimilarPhrases?txt=",ut,r;return(!0||document.location.href.indexOf("cdn.moorestephens.org")>-1)&&(a="https://cdn.moorestephens.org/InternationalDirectory/json/reos.json",nt="https://cdn.moorestephens.org/InternationalDirectory/json/committees.json",v="https://cdn.moorestephens.org/InternationalDirectory/json/countries.json",y="https://cdn.moorestephens.org/InternationalDirectory/json/menuItems.json",p="https://cdn.moorestephens.org/InternationalDirectory/json/pageContents.json",w="https://cdn.moorestephens.org/InternationalDirectory/json/firms.json",b="https://cdn.moorestephens.org/InternationalDirectory/json/correspondentFirms.json",k="https://cdn.moorestephens.org/InternationalDirectory/json/associatedFirms.json",d="https://cdn.moorestephens.org/InternationalDirectory/json/contacts.json"),ut=function(){localStorage.removeItem(u);localStorage.removeItem(tt);localStorage.removeItem(f);localStorage.removeItem(e);localStorage.removeItem(o);localStorage.removeItem(s);localStorage.removeItem(h);localStorage.removeItem(c);localStorage.removeItem(l);localCache={}},r={},r.isFirstUse=function(){var n=localStorage.getItem("MStphIsFirstUse");return n&&n=="false"?!1:!0},r.recordAgreement=function(){localStorage.setItem("MStphIsFirstUse","false");var n=new Date,t="You agreed on "+n.getFullYear()+"-"+months[n.getMonth()+1]+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes();localStorage.setItem("MStphTermsAgreedOn",t)},r.getAgreedDate=function(){return localStorage.getItem("MStphTermsAgreedOn")},r.getLastUpdatedDateAsString=function(){var t;try{if(t=localStorage.getItem("MStphLastUpdated"),t){var n=t.toString(),f=n.charAt(0)+n.charAt(1)+n.charAt(2)+n.charAt(3),e=n.charAt(4)+n.charAt(5),o=n.charAt(6)+n.charAt(7),s=parseInt(f),h=parseInt(e),c=parseInt(o),i=s+" "+months[h]+" "+c;try{var r=n.charAt(8)+n.charAt(9),u=n.charAt(10)+n.charAt(11),l=parseInt(r),a=parseInt(u);return l>0||a>0?i+(" "+r+":"+u):i}catch(v){return i}}}catch(v){}},r.getFavLabel=function(n,t){var f="MStphFav_"+t,i=localStorage.getItem(f),u=[],e,r;if(console_log("existingFavs: "+i),i&&i!="null")u=i.split(",");else return"ADD BOOKMARK";for(e=!1,r=0;r<u.length;r++)if(u[r]==n)return"REMOVE BOOKMARK";return"ADD BOOKMARK"},r.toggleFavourite=function(n,t){var f="MStphFav_"+t,r=localStorage.getItem(f),i=[],e,u;for(i=r&&r!="null"?r.split(","):[],console_log("existingFavArray: "+i),e=!1,u=0;u<i.length;u++)i[u]==n&&(i.splice(i.indexOf(n),1),e=!0);e?alert("Bookmark has been removed."):(i.push(n),alert("Bookmark has been added."));localStorage.setItem(f,i.join(","));r=localStorage.getItem(f);console_log("existingFavs: "+r)},r.getFavIdArray=function(n){var i="MStphFav_"+n,t=localStorage.getItem(i);return t&&t!="null"?t.split(","):[]},r.persistJsonToLocalStorage=function(n,t){localStorage.setItem(n,JSON.stringify(t));localStorage.setItem("MStphLastUpdated",t.lastUpdated);localCache[n]=JSON.stringify(t)},r.readDataFromLocalStorage=function(n){var t="",r;try{t=localCache[n]}catch(u){}return t||t==""||(t=localStorage.getItem(n)),g==!1&&t!=null?(r=JSON.parse(t),r.lastUpdated>getDateOfWeekAgoAsInt()?r:r.d.length>0&&!(i.isOnline>0)?r:{lastUpdated:0,d:[]}):{lastUpdated:0,d:[]}},r.getApiPromise=function(t){return t.indexOf("?")>-1?n.get(t+"&ck="+r.getCacheBuster()):n.get(t+"?ck="+r.getCacheBuster())},r.getCacheBuster=function(){var n=new Date;return n.getYear()+n.getMonth()+n.getDay()+"sdfsdfsdfsdf"},r.filterByField=function(n,t,i){for(var u=[],r=0;r<n.length;r++)n[r][t]==i&&u.push(n[r]);return u},r.setScopeREOs=function(n,t){t||(t=!1);var i=r.readDataFromLocalStorage(u);t==!0||i.d.length==0?r.getApiPromise(a).success(function(t){r.persistJsonToLocalStorage(u,t);n(t.d)}).error(function(){alert("error")}):n(i.d)},r.setScopeCountries=function(n,t){t||(t=!1);var i=r.readDataFromLocalStorage(f);t==!0||i.d.length==0?r.getApiPromise(v).success(function(t){r.persistJsonToLocalStorage(f,t);n(t.d)}).error(function(){alert("error")}):n(i.d)},r.getCountry=function(n,t){for(var i=0;i<n.length;i++)if(n[i].id==t)return n[i];return null},r.getState=function(n,t){if(t&&t>0){for(var i=0;i<n.length;i++)if(n[i].id==t)return n[i];return null}return n[0]},r.setScopeMenuItems=function(n,t){t||(t=!1);var i=r.readDataFromLocalStorage(e);t==!0||i.d.length==0?r.getApiPromise(y).success(function(t){r.persistJsonToLocalStorage(e,t);n(t.d)}).error(function(){alert("error")}):n(i.d)},r.setScopePageContents=function(n,t){t||(t=!1);var i=r.readDataFromLocalStorage(o);t==!0||i.d.length==0?r.getApiPromise(p).success(function(t){r.persistJsonToLocalStorage(o,t);n(t.d)}).error(function(){alert("error")}):n(i.d)},r.setScopeCorrespondentFirms=function(n,t){t||(t=!1);var i=r.readDataFromLocalStorage(h);t==!0||i.d.length==0?r.getApiPromise(b).success(function(t){r.persistJsonToLocalStorage(h,t);n(t.d)}).error(function(){alert("error")}):n(i.d)},r.setScopeAssociatedFirms=function(n,t){t||(t=!1);var i=r.readDataFromLocalStorage(c);t==!0||i.d.length==0?r.getApiPromise(k).success(function(t){r.persistJsonToLocalStorage(c,t);n(t.d)}).error(function(){n(null)}):n(i.d)},r.setScopeFirms=function(n,t){t||(t=!1);var i=r.readDataFromLocalStorage(s);t==!0||i.d.length==0?r.getApiPromise(w).success(function(t){r.persistJsonToLocalStorage(s,t);n(t.d)}).error(function(){alert("error")}):n(i.d)},r.setScopeFavFirms=function(n){var t=[],i=r.getFavIdArray("firm");r.setScopeFirms(function(u){t=t.concat(r.getFirms(u,i));!1&&t?n(t):r.setScopeCorrespondentFirms(function(u){t=t.concat(r.getFirms(u,i));!1&&t?n(t):r.setScopeAssociatedFirms(function(u){try{t=t.concat(r.getFirms(u,i))}catch(f){}!1&&t?n(t):r.setScopeREOs(function(u){t=t.concat(r.getFirms(u,i));t&&n(t)})})})})},r.setScopeSingleFirm=function(n,t){var i=null;r.setScopeFirms(function(u){i=r.getFirm(u,n);i?t(i):r.setScopeCorrespondentFirms(function(u){i=r.getFirm(u,n);i?t(i):r.setScopeAssociatedFirms(function(u){try{i=r.getFirm(u,n)}catch(f){i=null}i?t(i):r.setScopeREOs(function(u){i=r.getFirm(u,n);i&&t(i)})})})})},r.getFirm=function(n,t){for(var i=0;i<n.length;i++)if(n[i].id==t)return n[i];return null},r.getFirms=function(n,t){for(var r,u=[],i=0;i<n.length;i++)for(r=0;r<t.length;r++)n[i].id==t[r]&&u.push(n[i]);return u},r.setScopeContacts=function(n,t){t||(t=!1);var i=r.readDataFromLocalStorage(l);t==!0||i.d.length==0?r.getApiPromise(d).success(function(t){r.persistJsonToLocalStorage(l,t);n(t.d)}).error(function(){alert("error")}):n(i.d)},r.setScopeFavContacts=function(n){var t=[],i=r.getFavIdArray("contact");r.setScopeContacts(function(u){t=t.concat(r.getContacts(u,i));n(t)})},r.getContact=function(n,t){for(var i=0;i<n.length;i++)if(n[i].id==t)return n[i];return null},r.getContacts=function(n,t){for(var r,u=[],i=0;i<n.length;i++)for(r=0;r<t.length;r++)n[i].id==t[r]&&u.push(n[i]);return u},r.getMainContactsForFirm=function(n,t,i){for(var h,f,s,e,o=[],u=0;u<t.cs.length;u++)if(h=r.filterByField(o,"id",t.cs[u].id),h.length==0&&(f=r.getContact(n,t.cs[u].id),f)){for(s=!1,e=0;e<i.length;e++)i[e].id==f.id&&(s=!0);s==!1&&(f.r=t.cs[u].r,f.l=t.cs[u].l,o.push(f))}return o},r.getInternationalContactsForFirm=function(n,t){var f=[],i,e,u;for(t.ics||(t.ics=[]),t.cs||(t.cs=[]),i=0;i<t.ics.length;i++)e=r.filterByField(f,"id",t.ics[i].id),e.length==0&&(u=r.getContact(n,t.ics[i].id),t.ics[i].r&&t.ics[i].r!=""&&(u.r=t.ics[i].r),u.l=t.ics[i].l,f.push(u));return f},r.updateDataNow=function(n){r.setScopeMenuItems(function(){r.setScopeCountries(function(){r.setScopeFirms(function(){r.setScopeContacts(function(){r.setScopeREOs(function(){r.setScopeCorrespondentFirms(function(){r.setScopeAssociatedFirms(function(){n(!0)},!0)},!0)},!0)},!0)},!0)},!0)},!0)},r.getSimilarPhrasesForContacts=function(n,t){r.getApiPromise(it+n).success(function(n){t(n.d)})},r.getSimilarPhrasesForFirms=function(n,t){r.getApiPromise(rt+n).success(function(n){t(n.d)})},r}]);
/*
//# sourceMappingURL=dataMgr.min.js.map
*/